
## 数据模型与查询语言 [ ](Designing Data-Intensive Applications_20210917101115628)

### 关系模型与文档模型相关思考 [ ](Designing Data-Intensive Applications_20210917101115631)
+ 对象-关系不匹配：
  + 存在问题：{{c1::如果数据存储在关系表中，那么应用层代码中的对象与表、行和列的数据库模型之间**需要一个笨拙的转换层**。ORM框架则减少了此转换层所需的样板代码量，但是他们**并不能完全隐藏**两个模型之间的**差异**。}}
  + JSON模型 VS 关系模型：
    + JSON优势：{{c1::JSON表示比多表模式具有更好的局部性。如果要在关系模式中读取一份简历，那么要么执行多个査询(通过user_id査询每个表)，要么在 users表及其从属表之间执行混乱的多路联结。而对于JSON表示方法，所有的**相关信息都在一个地方一次査询就够了**。}}
    + 支持文档数据模型的主要论点：{{c1::文档数据模型灵活性，由于**局部性而带来较好的性能**，对于某些应用来说，它更接近于应用程序所使用的数据结构。关系模型则**强在联结操作、多对一和多对多关系更简洁的表达上**，与文档模型抗衡。}}
+ **多对一**与**多对多**的关系：
  + 问题：在简历的关系模式中，region_id和industry_id定义为ID,而不是纯文本字符串形式，例如 Greater Seattle Area"和" Philanthropy"。为什么这样做呢？
    + **避免岐义**：{{c1::(例如，如果存在一些同名的城市)。}}
    + **易于更新**：{{c1::名字只保存一次，因此，如果需要改变（例如，由于政治事件而更改城市名称），可以很容易全面更新。}}
    + **本地化支持**：{{c1::当网站被翻译成其他语言时，标准化的列表可以方便本地化，因此地区和行业可以用査看者的母语来显示}}
    + **更好的搜索支持**：{{c1::例如，搜索华盛顿州的慈善家可以匹配到这个简历，这是因为地区列表可以将西雅图属于华盛顿的信息编码进来（而从“大西雅图地区”字符串中并不能看出来西雅图属于华盛顿）。}}
  + 使用外键ID的好处：{{c1::因为它**对人类没有任何直接意义**，所以永远不需要直接改变：即使**ID标识的信息发生了变化，它也可以保持不变**。任何对人类有意义的东西都可能在将来某个时刻发生变更。如果这些信息被复制，那么所有的冗余副本也都需要更新。这会导致更多写入开销，并且**存在数据不一致的风险**（信息的一些副本被更新，而其他副本未更新）。**消除这种重复正是数据库规范化的核心思想**。}}


### 关系数据库与文档数据库现状 [ ](Designing Data-Intensive Applications_20210917101115633)
+ **哪种数据模型的应用代码更简单**：{{c1::通常无法一概而论哪种数据模型的应用代码更简单。这主要取决于数据项之间的关系类型。对于高度关联的数据，文档模型不太适合，关系模型可以胜任，而图模型(参阅本章后面的“图状数据模型”)则是最为自然的}}
+ **文档模型中的模式灵活性**：{{c1::例如，当前用户的全名存储在一个字段中，而现在想分别存储名字和姓氏。在文档数据库中只需使用新字段来编写新文档，并在应用层来处理读取旧文档的情况。![](https://gitee.com/xieyun714/nodeimage/raw/master/img/20210912152336.png)在大表上运行 UPDATET语句，对于任何数据库都可能会很慢，因为每一行都需要重写。}}
+ **查询的数据局部性**:{{c1::当查询一小部分内容时，对于文档模型通常需要加载整个文档，导致浪费。因此通常建议文档应该尽量小且避免写入时增加文档大小。这些性能方面的不利因素大大限制了文档数据库的适用场景。}}

### 数据查询语言 [ ](Designing Data-Intensive Applications_20210917101115635)
+ 命令式VS声明式：{{c1::类似`CSS` `SQL`都是声明式数据查询语言，一般比命令式数据查询语言更加简洁与强大。![](https://gitee.com/xieyun714/nodeimage/raw/master/img/20210912174449.png)![](https://gitee.com/xieyun714/nodeimage/raw/master/img/20210912174434.png)}}
+ `MapReduce`查询简介：
  + 问题：假设你是一名海洋生物学家，每当你看到海洋中的动物时，就会在数据库中添加观察记录。现在你想生成一份报告，来说明每个月看到了多少鲨鱼
  + SQL实现：{{c1::![](https://gitee.com/xieyun714/nodeimage/raw/master/img/20210912174634.png)}}
  + MongoDB MapReduce实现:{{c1::![](https://gitee.com/xieyun714/nodeimage/raw/master/img/20210912174707.png)![](https://gitee.com/xieyun714/nodeimage/raw/master/img/20210912174717.png)}}
  + MongoDB的聚合管道的声明式査询语言：{{c1::![](https://gitee.com/xieyun714/nodeimage/raw/master/img/20210912174904.png)![](https://gitee.com/xieyun714/nodeimage/raw/master/img/20210912175259.png)}}

### 图状数据模型 [ ](Designing Data-Intensive Applications_20210917101115637)